<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment - IPL Tickets</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body {margin:0;padding:0;font-family:'Roboto',sans-serif;background:#f0f0f0;color:#000;}
.container{max-width:800px;margin:30px auto;padding:20px;}
.payment-box{background:#fff;border-radius:15px;padding:30px;box-shadow:0 12px 25px rgba(0,0,0,0.1);text-align:center;border-top:6px solid #0b81d1;}
.payment-box h2{font-size:26px;margin-bottom:15px;color:#000;font-weight:700;}
.match-info{text-align:center;margin-bottom:20px;line-height:1.6;}
.match-info img{max-width:70px;height:70px;object-fit:contain;border-radius:10px;margin:5px;}
.total-amount{font-size:20px;font-weight:700;margin:15px 0;color:#d32f2f;}
.qr-container{margin:20px 0;display:inline-block;padding:15px;border:2px dashed #0b81d1;border-radius:15px;background:#f9f9f9;}
.qr-container img{width:200px;height:200px;}
input#utrInput{padding:12px;font-size:16px;width:90%;max-width:260px;border-radius:8px;border:1px solid #ccc;margin-top:15px;text-align:center;}
button#payWithUTR{padding:14px 25px;font-size:16px;font-weight:700;border:none;border-radius:10px;cursor:pointer;color:#fff;background:linear-gradient(90deg,#4caf50,#43a047);margin-top:20px;transition:0.3s;}
button#payWithUTR:hover{background:linear-gradient(90deg,#43a047,#388e3c);}
</style>
</head>
<body>

<div class="container">
  <div class="payment-box">
    <h2>Scan & Pay for IPL Ticket</h2>

    <div class="match-info" id="matchInfo"></div>

    <p class="total-amount" id="totalAmount"></p>

    <div class="qr-container">
      <img src="https://iili.io/K8pC8WG.png" alt="Scan to Pay QR">
    </div>

    <p>भुगतान करने के बाद Transaction ID (UTR/Ref No.) दर्ज करें:</p>
    <input type="text" id="utrInput" placeholder="Enter 12-digit UTR">

    <br>
    <button id="payWithUTR">Confirm Payment & Get Ticket</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// --- DEMO DATA SETUP ---
// यह डेटा आमतौर पर पिछले 'सीट चयन' पेज से आएगा। 
// इसे मैंने यहाँ सेट किया है ताकि यह पेज अकेले काम कर सके।
const demoTicketData = {
    matchDetails: {
        teams: "Chennai Super Kings vs Mumbai Indians",
        stadium: "Wankhede Stadium, Mumbai",
        date: "2025-10-25",
        time: "19:30",
        img1: "https://iili.io/K8L5Ots.jpg", // CSK Logo
        img2: "https://iili.io/Jc8702V.png"  // MI Logo
    },
    price: 2500, // Base Price
    qty: 2,      // Quantity
    total: 5900, // Total Amount including taxes/fees
    seatType: "VIP",
    // bookingId and UTR will be added on successful payment
};
localStorage.setItem('paymentInfo', JSON.stringify(demoTicketData));
// --- END DEMO DATA SETUP ---


// Firebase config (Replace with your actual Firebase config)
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://pl-project-f9be7-default-rtdb.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
// firebase.initializeApp(firebaseConfig); // Uncomment if using Firebase
// const db = firebase.database(); // Uncomment if using Firebase

// Load selected ticket from localStorage
const ticketData = JSON.parse(localStorage.getItem('paymentInfo'));
if(!ticketData){ 
  alert("❌ कोई डेटा नहीं मिला, कृपया फिर से मैच बुक करें।");
  // window.location.href="match-details.html"; // Uncomment for redirect
}

const DEFAULT_LOGO = "https://iili.io/K8L5Ots.jpg";
document.getElementById('matchInfo').innerHTML = `
  <strong>${ticketData.matchDetails.teams}</strong><br>
  ${ticketData.matchDetails.date} | ${ticketData.matchDetails.time || '—'}<br>
  ${ticketData.matchDetails.stadium}<br>
  <img src="${ticketData.matchDetails.img1 || DEFAULT_LOGO}" alt="Team 1">
  <img src="${ticketData.matchDetails.img2 || DEFAULT_LOGO}" alt="Team 2">
  <br><br>
  <strong>Seat Type:</strong> ${ticketData.seatType} <br>
  <strong>Quantity:</strong> ${ticketData.qty}
`;
document.getElementById('totalAmount').textContent = `Total Amount: ₹${ticketData.total}`;

// Confirm Payment
document.getElementById('payWithUTR').addEventListener('click', ()=>{
  const utr = document.getElementById('utrInput').value.trim();
  const utrRegex = /^\d{12}$/;
  
  if(!utrRegex.test(utr)){
      alert("❌ कृपया मान्य 12 अंकों का UTR दर्ज करें।");
      return;
  }

  // Generate unique seat details (SHOULD BE DONE ON SERVER/FIREBASE)
  const ZONES = ["NORTH", "SOUTH", "EAST", "WEST"];
  const TIERS_PREFIX = ["LOWER", "UPPER", "EXECUTIVE"];
  const ROW_LETTERS = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  
  ticketData.seatDetails = {
    GATE: (Math.floor(Math.random() * 8) + 1).toString().padStart(2,"0"),
    ZONE: ZONES[Math.floor(Math.random() * ZONES.length)],
    TIER_BLOCK: TIERS_PREFIX[Math.floor(Math.random() * TIERS_PREFIX.length)].substring(0,1)+ (Math.floor(Math.random()*5)+1),
    ROW: ROW_LETTERS[Math.floor(Math.random()*ROW_LETTERS.length)],
    SEAT_NO: (Math.floor(Math.random()*50)+1).toString().padStart(3,"0"),
    matchNo: (Math.floor(Math.random()*50)+1).toString().padStart(2,"0")
  };
  
  // Finalize data
  ticketData.utr = utr;
  ticketData.bookingId = 'IPL' + Date.now().toString().slice(-8); 

  // Store final data for the ticket page
  localStorage.setItem('finalTicket', JSON.stringify(ticketData));
  
  // --- Start Firebase/Server Save Logic (UNCOMMENT IF USED) ---
  /* db.ref('bookings/' + ticketData.bookingId).set(ticketData)
    .then(()=>{
        alert(`✅ Payment Successful! Booking ID: ${ticketData.bookingId}`);
        window.location.href = `ticket.html?bookingId=${ticketData.bookingId}`;
    })
    .catch((err)=>{
        console.error(err);
        alert("❌ Payment save failed, trying to redirect using local data.");
        window.location.href = `ticket.html?bookingId=${ticketData.bookingId}`; // Fallback redirect
    });
  */
  // --- End Firebase/Server Save Logic ---

  // For this local environment, we just redirect after saving to a *different* local storage key
  alert(`✅ Payment Successful! Booking ID: ${ticketData.bookingId}`);
  window.location.href = `ticket.html?bookingId=${ticketData.bookingId}`;
});
</script>

</body>
</html>
